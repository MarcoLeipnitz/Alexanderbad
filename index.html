<!DOCTYPE html>
<html lang="de">
	<head>
		<title>Alexanderbad Wassertemperatur</title>
		<meta charset="utf-8">
		<link rel="manifest" href="manifest.json"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Die aktuelle Wassertemperatur des Alexanderbads in Erbach kann hier digital eingesehen werden.">
    <meta name="theme-color" content="#d3d3d3"/>

		<style>     
			@font-face {
				font-family: OpenSans;
				src: url("./open-sans.semibold.ttf");
			}

			[hidden] {
				display: none !important;
			}

			img {
				user-select: none;
			}
		
			.dot {
				  height: min(25vw, 60vh);
				  width: auto;
         		  aspect-ratio: 1 / 1;
				  right: 0;
				  left: calc(-1 * min(25vw, 60vh)/2);
				  top: calc(-1 * min(25vw, 60vh)/2);
				  background-color: #0190e1;
				  border-radius: 50%;
				  display: inline-block;
				  position: absolute;
			}
			
			html{
				scrollbar-width: none;
       		    scrollbar-color: #bebebe #FFF;
				overflow: hidden;
				margin: 0;
			}
			
			h1{
      		    margin: 0;
				text-align: center;
			}

			div{
				margin: 0;
				left: 0;
				top: 0;
				position: absolute;
				text-align: center;
				vertical-align: middle;
				font-family: 'OpenSans', 'Bahnschrift';
			}

			.footcol{
				width: 25%;
				height: 100%;
				display: flex;
				justify-content: center;
				align-items: center;
				text-decoration: underline;
			}

			a{
				color: black;
				cursor: pointer;
        		text-decoration: underline;
			}

			#imp{
				width: 100%; 
				height: 100%; 
				background-color: rgba(100, 100, 100, .6); 
				top: 100%; 
				transition: top 2s ease-in-out;
			}

			#infobox{
				width: 100%; 
				height: 100%; 
				background-color: rgba(100, 100, 100, .6); 
				transition: opacity 1s ease-in-out;
			}

			@keyframes impstart {
				from {top: 100%;}
				to {top: 0%;}
			}

			@keyframes impend {
				from {top: 0%;}
				to {top: 100%;}
			}

			table{
				width: 100%;
			}

			td{
				width: 25vw;
				height: 10svh;
				font-size: min(4.5vw, 5vh);
			}

			#TText, #renew {
				opacity: 0;
				transition: opacity 1.5s ease-in-out;
			}

			#navbar {
				display: flex;
				height: 10svh;
				top: 90svh;
				width: 100svw;
				border-top: 2px solid #CCC;
				justify-content: space-between;
				align-items: center;
				transition: all 0.5s;
				user-select: none;
			}

			#navbar > div {
				position: relative;
				height: 80%;
				flex-grow: 1;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				flex-basis: 100%;
				justify-content: space-between;
				display: flex;
				cursor: pointer;
			}

			#navbar > div > div {
				position: relative;
				height: 60%;
				font-size: 2cqh;
				margin-bottom: .3svh;
				transition: color 0.25s;
			}

			#navbar > div > div > img{
				height: 100%;
				background-color: #AAA;
				transition: background-color 0.25s;
			}

			#install {
				color: #7748D9;
			}

		</style>
	</head>
	
	<body>
    <div class="dot"></div>
    <div style="width: 75vw; height: min(12.5vw, 30svh); left: 12.5vw; display: inline-flex; align-items: center; justify-content: center;"><h1 style="font-size: min(8vw, 20vh);">Wassertemperatur</h1></div>
    <div style="width: 12.5vw; height: 12.5vw; display: inline-block; left: 87.5vw;"></div>
    <div style="width: 100vw; height: calc(70svh - min(12.5vw, 30svh)); top: min(12.5vw, 30svh); display: inline-flex; justify-content: center; align-items: center; font-size: 25vmin;"><b id="TText">[TEMP]&degC</b></div>
    <div id="renew" style="width: 100vw; height: 10svh; top: 70svh; display: inline-flex; justify-content: center; align-items: center; font-size: 6vmin;">Letzte Aktualisierung 00:00</div>
    <div id="navbar">
		<div id="install" onclick="installApp();" hidden>
			<div><img style="background-color: #7748D9;" src="./images/icons/appdownload.png"></div>
			<div>App</div></div>
		<div id="waternav" onclick="navhandler(1);"><div><img src="./images/icons/temperature.png"></div><div>Wasser</div></div>
		<div id="contactnav" onclick="navhandler(2);"><div><img src="./images/icons/contact.png" style="font-size: 10%;"></div><div>Kontakt</div></div>
		<div id="newsnav" onclick="navhandler(3);"><div><img src="./images/icons/news.png"></div><div>Neues</div></div>
		<div id="share" onclick="navhandler(4);"><div><img src="./images/icons/sharearrow.png"></div><div>Teilen</div></div>
	</div>

    <div id="imp">
			<div style="background-color: white; height: 70svh; width: min(80vw, 80vh); margin-top: 15svh; margin-left: calc((100vw - min(80vw, 80vh))/2); border-radius: 30px;">
				<div style="height: 15%; width: 100%; background-color: #0190e1; border-radius: 30px 30px 0 0; display:flex; align-items: center; justify-content: center; color: rgb(255, 255, 255); font-size: 3vh;">Impressum & Kontakt</div>
				<div style="height: 70%; width: 100%; top: 15%; background-color: rgb(255, 255, 255);">
					<div style="height: 20%; width: 100%; justify-content: center; align-items: center; display: flex; font-size: 2.5vh;">Verantwortlicher für die Webseite</div>
					<div style="height: 20%; width: 100%; justify-content: center; align-items: center; display: flex; font-size: 3vh; top: 20%;">
						Herr Marco Leipnitz
					</div>
					<div style="height: 20%; width: 100%; justify-content: center; align-items: center; display: flex; font-size: 3vh; top: 40%;">
						Wiesenweg Nr.11 <br>
						64711 Erbach
					</div>
					<div style="height: 20%; width: 100%; justify-content: center; align-items: center; display: flex; font-size: 3vh; top: 60%;">
						alexanderbad@erbach.de <br>
						06062-266909
					</div>
				</div>
				<div style="height: 15%; width: 100%; top: 85%; background-color: rgb(255, 255, 255); border-radius: 0 0 30px 30px; border-top: 1px dashed black; display: flex; align-items: center; justify-content: center; color: rgb(100, 100, 100); font-size: 3vh; cursor: pointer;" onclick="imp();">Impressum schließen</div>
			</div>
		</div>

    <div id="infobox" style="display: none;">
			<div style="background-color: white; height: 70svh; width: min(80vw, 80vh); margin-top: 15svh; margin-left: calc((100vw - min(80vw, 80vh))/2); border-radius: 30px;">
				<div style="height: 15%; width: 100%; background-color: #0190e1; border-radius: 30px 30px 0 0; display:flex; align-items: center; justify-content: center; color: rgb(255, 255, 255); font-size: 4.5cqh;">Hinweis</div>
        <div style="height: 70%; width: 100%; top: 15%; justify-content: center; overflow-y: auto;">
          <div id="infohead" style="height: 25%; width: 100%; justify-content: center; font-size: 5vmin; align-items: center; display: flex;"><b></b></div>
          <div id="infotext" style="height: 75%; width: 80%; top: 25%; left: 10%; justify-content: center; font-size: 4vmin;"></div>
        </div>
				<div style="height: 15%; width: 100%; top: 85%; background-color: rgb(255, 255, 255); border-radius: 0 0 30px 30px; border-top: 1px dashed black; display: flex; align-items: center; justify-content: center; color: rgb(100, 100, 100); font-size: 3vh; cursor: pointer;" onclick="info();">Hinweis schließen</div>
			</div>
		</div>
    
    <script>    
		const serverURL = "https://alexanderbad-webserver.glitch.me";

        let installprompt;
        window.addEventListener('beforeinstallprompt', (e) => {
        	e.preventDefault();
        	installprompt = e;
        	document.getElementById("install").removeAttribute("hidden");
        });

        if('serviceWorker' in navigator){
        	window.addEventListener('load', () => {
            navigator.serviceWorker
                .register("/serviceworker.js", { scope: '/' })
              	.then(reg => console.log("Ok"))
              	.catch(err => console.log("Service Worker Error: " + err));
          	});
      	}
      
		var impopen = false;

		function delay(time) {
			return new Promise(resolve => setTimeout(resolve, time));
		}
			
		const shareData = {
			title: 'Alexanderbad Wassertemperatur',
			text: 'Schau dir die digitale Wassertemperaturanzeige des Alexanderbads an!',
			url: 'https://alexanderbad.de'
		}

		document.getElementById("share").addEventListener('click', async () => {
			let temp = true;
			try {
				await navigator.share(shareData);
				temp = false;
			} catch (err) {
				if(temp){
					document.getElementById("share").children[1].innerText = "Kopiert!";
					await navigator.clipboard.writeText("Schau dir die digitale Wassertemperaturanzeige des Alexanderbads unter https://alexanderbad.de an!");
					delay(2000).then(() => document.getElementById("share").children[1].innerText = "Teilen");
				}
			}
		});

		function installApp(){
			installprompt.prompt();
			installprompt.userChoice
			.then((result) => {
				document.getElementById("install").remove();
				if(result.outcome == "accepted"){
				document.getElementById("infohead").innerText = "WebApp wird installiert..";
				document.getElementById("infotext").innerText = "Vielen Dank, dass Sie sich für unsere WebApp entschieden haben! \n\n Diese App funktioniert genau so, wie sie es von den Apps aus Ihrem Store kennen. \n\n Bei PC-Nutzern kann nun einfach 'Alexanderbad' in die Suchleiste für Programme eingegeben werden.";
				info();
				}else{
				document.getElementById("infohead").innerText = "Unsere WebApp";
				document.getElementById("infotext").innerText = "Die Installation der Alexanderbad App wurde abgebrochen.. \n\n Die App ist komfortabel und bringt die Wassertemperatur direkt auf den Startbildschirm. \n\n Falls Sie die App doch herunterladen möchten, laden Sie bitte die Seite neu.";
				info();
				}
				installprompt = null;
			});
		}
      
	  	function imp()
			{
				if(!impopen){
					document.getElementById("imp").style.top = "0%";
				}else{
					document.getElementById("imp").style.top = "100%";
				}
				impopen = !impopen;
			}	

		function info(){
			if(document.getElementById("infobox").style.display == 'none'){
				document.getElementById("infobox").style.display = 'block';
				delay(500).then(() => document.getElementById('infobox').style.opacity = '1');
			}else{
				document.getElementById('infobox').style.opacity = '0';
				delay(1000).then(() => document.getElementById("infobox").style.display = 'none');
			}
		}

		function setupinfo(){
			let infohead = "Bis zur Badesaison 2025"//"[InfoTitle]";
			let infotext = `<img src="./images/Nachbereitung_100Jahre.webp" alt="Bild von Ihrem Schwimmbadteam in der Nachbereitung. v.l.n.r Jürgen Hörst, Maike Wagner, Frank Weickart, Marco Leipnitz, Sebastian Hörr" style="aspect-ratio: 4/3;width: 100%;border-radius: 10px;">
							<br><br>
							Sehr geehrte Badegäste,<br><br>
							Trotz teils verregnetem Sommer hatten wir während der Saison wieder eine schöne Zeit mit Ihnen.<br><br>
							Insbesondere hoffen wir, dass auch Sie eine solche angenehme Zeit hatten.<br><br>
							Genießen Sie bis nächstes Jahr unser Gedicht über die vergangenen 4 Monate<br><br>

							\"<i>Achtung Achtung eine Durchsage:<br><br>
							Ein letztes Mal in der Saison ist es die Aufmerksamkeit, nach der ich frage.<br><br>
							Trotz kaltem Wind und nassem Sturm schauen wir stets auf die mehr oder weniger akkuraten Schwimmbaduhren<br><br>
							Seien Sie nicht getrügt von des Temperatursystems Spiel!<br><br>
							Manchmal war die gemessene Temperatur etwas zu wenig, manchmal zu viel.<br><br>
							Und selbst wenn die Technik ab und an nicht ganz so verlässlich besteht<br><br>
							Die schöne Zeit mit Ihnen ist doch die Quintessenz, um die es uns geht<br><br>
							Ein schönes Gespräch, Kilometer zu schwimmen, Volleyball spielen, neue Zeiten erklimmen<br><br>
							Doch sehr geehrte Badegäste, eines ist klar:<br><br>
							Frohe Weihnachten, guten Rutsch, bis zur nächsten Saison im kommenden Jahr!\"</i><br><br>
							<br>
							Wir freuen uns schon auf die nächsten <b>100</b> Jahre Alexanderbad und vor allem auf <b>Sie</b> in der nächsten Badesaison!<br><br>
							<b>- Ihr Alexanderbad Team -</b>
							`//"[InfoText]";

			document.getElementById("infohead").innerHTML = "<b>" + infohead + "</b>";
			document.getElementById("infotext").innerHTML = infotext;
			if(!(infohead === "[InfoTitle]" && infotext === "[InfoText]")){
				//info();
			}
		}

		async function refreshData(tries) {
			if(tries == 5){
				document.getElementById("TText").innerHTML = "--.-&degC";
				document.getElementById("renew").innerText = "Keine Verbindung zum Server möglich!";
				document.getElementById("TText").style.opacity = "1";
				document.getElementById("renew").style.opacity = "1";
				return
			}
			try {
				await fetch(serverURL + "/wt", {
						method: 'GET',
						headers: {
							'Accept': 'html/text',
						},
				})
				.then(response => response.text())
				.then(res => {
					if(res.length == 6)	res = res.substring(0,2) + "0" + res.substring(2);
					
					document.getElementById("TText").innerHTML = res.substring(0,2) + "." + res.charAt(2) + "&degC";
					document.getElementById("renew").innerText = "Letzte Aktualisierung " + res.substring(3,5) + ":" + res.substring(5);
					document.getElementById("TText").style.opacity = "1";
					document.getElementById("renew").style.opacity = "1";
				});
			} catch (error) {
				document.getElementById("TText").innerText = "Lädt";
				document.getElementById("renew").innerText = "Empfange Temperatur...";
				document.getElementById("TText").style.opacity = "1";
				document.getElementById("renew").style.opacity = "1";
				await delay(1500);
				document.getElementById("TText").style.opacity = "0";
				document.getElementById("renew").style.opacity = "0";
				await delay(1500);
				refreshData(++tries)
			}   
		}

		if (window.matchMedia('(display-mode: standalone)').matches) {
			setInterval(refreshData, 5 * 60 * 1000);
		}else{
			setInterval(refreshData, 12 * 60 * 1000);
		}

		let lastnavindex = 1
		async function navhandler(index) {
			document.getElementById("navbar").children[lastnavindex].children[0].children[0].style.backgroundColor = "";
			document.getElementById("navbar").children[lastnavindex].style.color = "";
			document.getElementById("navbar").children[index].children[0].children[0].style.backgroundColor = "#4848D9";
			document.getElementById("navbar").children[index].style.color = "#4848D9";

			if(index == 4){
				await delay(2000).then(() => {
					document.getElementById("navbar").children[4].children[0].children[0].style.backgroundColor = "";
					document.getElementById("navbar").children[4].style.color = "";
					document.getElementById("navbar").children[lastnavindex].children[0].children[0].style.backgroundColor = "#4848D9";
					document.getElementById("navbar").children[lastnavindex].style.color = "#4848D9";
				});
				return;
			}
			lastnavindex = index; //Fix this
		}

		navhandler(1);
		refreshData(0);
		setupinfo();
	</script>
  </body>
</html>